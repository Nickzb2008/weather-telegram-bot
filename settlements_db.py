# settlements_db.py
import json
import os
from typing import Dict, List, Optional, Tuple
import logging

logger = logging.getLogger(__name__)

class UkraineSettlementsDB:
    def __init__(self):
        self.settlements = {}
        self._load_extended_database()
        logger.info(f"Завантажено {len(self.settlements)} населених пунктів")
    
    def _load_extended_database(self):
        """Завантаження розширеної бази населених пунктів України"""
        # ========== ДОНЕЦЬКА ОБЛАСТЬ ==========
        # Слов'янськ та околиці
        self._add_settlement("Слов'янськ", 48.8531, 37.6050, "Донецька", "місто", 106000)
        self._add_settlement("Краматорськ", 48.7392, 37.5839, "Донецька", "місто", 157000)
        self._add_settlement("Дружківка", 48.6167, 37.5333, "Донецька", "місто", 59000)
        self._add_settlement("Костянтинівка", 48.5278, 37.7056, "Донецька", "місто", 70000)
        self._add_settlement("Лиман", 48.9833, 37.8167, "Донецька", "місто", 22000)
        self._add_settlement("Святогірськ", 49.0333, 37.5667, "Донецька", "місто", 4500)
        
        # Населені пункти навколо Слов'янська
        self._add_settlement("Андріївка", 48.9333, 37.6833, "Донецька", "селище", 2500)
        self._add_settlement("Билбасівка", 48.8500, 37.5500, "Донецька", "село", 1800)
        self._add_settlement("Бражине", 48.8833, 37.5167, "Донецька", "село", 1200)
        self._add_settlement("Григорівка", 48.9167, 37.7500, "Донецька", "село", 800)
        self._add_settlement("Дмитрівка", 48.9667, 37.6000, "Донецька", "село", 1500)
        self._add_settlement("Донецьке", 48.8667, 37.6667, "Донецька", "село", 900)
        self._add_settlement("Закітне", 48.9167, 37.6333, "Донецька", "село", 1100)
        self._add_settlement("Кам'янка", 48.9500, 37.5333, "Донецька", "село", 700)
        self._add_settlement("Карпівка", 48.9667, 37.6833, "Донецька", "село", 600)
        self._add_settlement("Красноармійське", 48.9333, 37.6167, "Донецька", "село", 1300)
        self._add_settlement("Миколаївка", 48.9000, 37.7000, "Донецька", "село", 1600)
        self._add_settlement("Новодмитрівка", 48.9833, 37.6500, "Донецька", "село", 1400)
        self._add_settlement("Олександрівка", 48.9167, 37.5833, "Донецька", "село", 1000)
        self._add_settlement("Привілля", 48.8833, 37.6167, "Донецька", "село", 1700)
        self._add_settlement("Райгородок", 48.8667, 37.7167, "Донецька", "село", 1900)
        self._add_settlement("Серебрянка", 48.9167, 37.6667, "Донецька", "село", 2200)
        self._add_settlement("Тетянівка", 48.9333, 37.5333, "Донецька", "село", 1100)
        self._add_settlement("Червоний Лиман", 48.9667, 37.7667, "Донецька", "село", 800)
        
        # Населені пункти навколо Краматорська
        self._add_settlement("Абазівка", 48.7833, 37.5167, "Донецька", "село", 900)
        self._add_settlement("Біленьке", 48.7667, 37.5500, "Донецька", "село", 1200)
        self._add_settlement("Білокузьминівка", 48.7167, 37.6167, "Донецька", "селище", 3500)
        self._add_settlement("Велика Камишуваха", 48.6667, 37.4833, "Донецька", "село", 1800)
        self._add_settlement("Галицинівка", 48.7000, 37.5333, "Донецька", "село", 1100)
        self._add_settlement("Грузько-Зорянське", 48.6833, 37.6667, "Донецька", "село", 1300)
        self._add_settlement("Іванопілля", 48.7333, 37.6833, "Донецька", "село", 1500)
        self._add_settlement("Іллінка", 48.7500, 37.6000, "Донецька", "село", 1600)
        self._add_settlement("Крамарка", 48.8000, 37.6500, "Донецька", "село", 1400)
        self._add_settlement("Красноторка", 48.7667, 37.6833, "Донецька", "селище", 8000)
        self._add_settlement("Малотаранівка", 48.6833, 37.6167, "Донецька", "село", 900)
        self._add_settlement("Новоекономічне", 48.7000, 37.5833, "Донецька", "село", 1700)
        self._add_settlement("Олексієво-Дружківка", 48.6333, 37.6167, "Донецька", "селище", 4200)
        self._add_settlement("Пантелеймонівка", 48.7333, 37.5333, "Донецька", "село", 1900)
        self._add_settlement("Петрівка", 48.6833, 37.5333, "Донецька", "село", 1100)
        self._add_settlement("Привілне", 48.7167, 37.6833, "Донецька", "село", 1300)
        self._add_settlement("Рай-Олександрівка", 48.7500, 37.6667, "Донецька", "село", 1500)
        self._add_settlement("Семенівка", 48.7833, 37.5833, "Донецька", "село", 1600)
        self._add_settlement("Софіївка", 48.7000, 37.6500, "Донецька", "село", 1400)
        self._add_settlement("Шабельківка", 48.7667, 37.6167, "Донецька", "селище", 5500)
        self._add_settlement("Ясна Поляна", 48.6833, 37.5833, "Донецька", "село", 1200)
        self._add_settlement("Ясногірка", 48.7333, 37.6167, "Донецька", "селище", 6800)
        
        # Додаткові міста Донецької області
        self._add_settlement("Донецьк", 48.0159, 37.8028, "Донецька", "обласний центр", 901000)
        self._add_settlement("Маріуполь", 47.0971, 37.5434, "Донецька", "місто", 431000)
        self._add_settlement("Макіївка", 48.0556, 38.0647, "Донецька", "місто", 344000)
        self._add_settlement("Горлівка", 48.3056, 38.0297, "Донецька", "місто", 242000)
        self._add_settlement("Єнакієве", 48.2311, 38.2053, "Донецька", "місто", 79300)
        self._add_settlement("Харцизьк", 48.0333, 38.1500, "Донецька", "місто", 59000)
        self._add_settlement("Шахтарськ", 48.0333, 38.4833, "Донецька", "місто", 51800)
        self._add_settlement("Сніжне", 48.0333, 38.7667, "Донецька", "місто", 47800)
        self._add_settlement("Торецьк", 48.3983, 37.8617, "Донецька", "місто", 34600)
        self._add_settlement("Ясинувата", 48.1167, 37.8333, "Донецька", "місто", 35800)
        self._add_settlement("Авдіївка", 48.1333, 37.7500, "Донецька", "місто", 32000)
        self._add_settlement("Добропілля", 48.4667, 37.0833, "Донецька", "місто", 29200)
        self._add_settlement("Волноваха", 47.6011, 37.4964, "Донецька", "місто", 21700)
        
        # ========== ВСІ ОБЛАСНІ ЦЕНТРИ ==========
        self._add_settlement("Київ", 50.4501, 30.5234, "Київська", "столиця", 2967000)
        self._add_settlement("Вінниця", 49.2328, 28.4816, "Вінницька", "обласний центр", 369000)
        self._add_settlement("Луцьк", 50.7472, 25.3254, "Волинська", "обласний центр", 217000)
        self._add_settlement("Дніпро", 48.4647, 35.0462, "Дніпропетровська", "обласний центр", 966000)
        self._add_settlement("Житомир", 50.2547, 28.6587, "Житомирська", "обласний центр", 261000)
        self._add_settlement("Ужгород", 48.6208, 22.2879, "Закарпатська", "обласний центр", 115000)
        self._add_settlement("Запоріжжя", 47.8229, 35.1903, "Запорізька", "обласний центр", 722000)
        self._add_settlement("Івано-Франківськ", 48.9226, 24.7111, "Івано-Франківська", "обласний центр", 238000)
        self._add_settlement("Кропивницький", 48.5132, 32.2597, "Кіровоградська", "обласний центр", 222000)
        self._add_settlement("Львів", 49.8397, 24.0297, "Львівська", "обласний центр", 717000)
        self._add_settlement("Миколаїв", 46.9750, 31.9946, "Миколаївська", "обласний центр", 480000)
        self._add_settlement("Одеса", 46.4825, 30.7233, "Одеська", "обласний центр", 1017000)
        self._add_settlement("Полтава", 49.5883, 34.5514, "Полтавська", "обласний центр", 279000)
        self._add_settlement("Рівне", 50.6199, 26.2516, "Рівненська", "обласний центр", 246000)
        self._add_settlement("Суми", 50.9077, 34.7981, "Сумська", "обласний центр", 259000)
        self._add_settlement("Тернопіль", 49.5535, 25.5948, "Тернопільська", "обласний центр", 225000)
        self._add_settlement("Харків", 49.9935, 36.2304, "Харківська", "обласний центр", 1441000)
        self._add_settlement("Херсон", 46.6354, 32.6169, "Херсонська", "обласний центр", 283000)
        self._add_settlement("Хмельницький", 49.4220, 26.9841, "Хмельницька", "обласний центр", 274000)
        self._add_settlement("Черкаси", 49.4444, 32.0598, "Черкаська", "обласний центр", 269000)
        self._add_settlement("Чернівці", 48.2921, 25.9358, "Чернівецька", "обласний центр", 265000)
        self._add_settlement("Чернігів", 51.4982, 31.2893, "Чернігівська", "обласний центр", 286000)
        self._add_settlement("Луганськ", 48.5736, 39.3078, "Луганська", "обласний центр", 401000)
        self._add_settlement("Сімферополь", 44.9521, 34.1024, "АР Крим", "обласний центр", 332000)
        self._add_settlement("Севастополь", 44.6167, 33.5254, "АР Крим", "місто", 343000)
        
        # ========== ІНШІ ВЕЛИКІ МІСТА ==========
        self._add_settlement("Кривий Ріг", 47.9105, 33.3918, "Дніпропетровська", "місто", 612000)
        self._add_settlement("Кам'янське", 48.5076, 34.6132, "Дніпропетровська", "місто", 235000)
        self._add_settlement("Кременчук", 49.0667, 33.4167, "Полтавська", "місто", 217000)
        self._add_settlement("Мелітополь", 46.8489, 35.3653, "Запорізька", "місто", 150000)
        self._add_settlement("Біла Церква", 49.7956, 30.1167, "Київська", "місто", 208000)
        self._add_settlement("Нікополь", 47.5667, 34.4000, "Дніпропетровська", "місто", 110000)
        self._add_settlement("Павлоград", 48.5200, 35.8700, "Дніпропетровська", "місто", 105000)
        self._add_settlement("Бердянськ", 46.7590, 36.7869, "Запорізька", "місто", 107000)
        self._add_settlement("Євпаторія", 45.1906, 33.3675, "АР Крим", "місто", 106000)
        self._add_settlement("Керч", 45.3567, 36.4758, "АР Крим", "місто", 147000)
        
        # ========== СЕЛА ТА СЕЛИЩА КИЇВСЬКОЇ ОБЛАСТІ ==========
        self._add_settlement("Вишневе", 50.3869, 30.3639, "Київська", "місто", 39000)
        self._add_settlement("Ірпінь", 50.5167, 30.2500, "Київська", "місто", 60000)
        self._add_settlement("Буча", 50.5500, 30.2167, "Київська", "місто", 36000)
        self._add_settlement("Боярка", 50.3300, 30.2889, "Київська", "місто", 35000)
        self._add_settlement("Гостомель", 50.5833, 30.2667, "Київська", "селище", 17000)
        self._add_settlement("Ворзель", 50.5500, 30.1500, "Київська", "селище", 6500)
        self._add_settlement("Іванків", 50.9333, 29.9000, "Київська", "селище", 11000)
        
        # ========== ЛЬВІВСЬКА ОБЛАСТЬ ==========
        self._add_settlement("Стрий", 49.2553, 23.8506, "Львівська", "місто", 59000)
        self._add_settlement("Дрогобич", 49.3500, 23.5000, "Львівська", "місто", 74000)
        self._add_settlement("Червоноград", 50.3833, 24.2333, "Львівська", "місто", 65000)
        self._add_settlement("Самбір", 49.5167, 23.2000, "Львівська", "місто", 34000)
        
        # ========== ХАРКІВСЬКА ОБЛАСТЬ ==========
        self._add_settlement("Ізюм", 49.2125, 37.2617, "Харківська", "місто", 46000)
        self._add_settlement("Лозова", 48.8833, 36.3167, "Харківська", "місто", 57000)
        self._add_settlement("Первомайський", 49.3833, 36.2167, "Харківська", "місто", 29000)
        self._add_settlement("Балаклія", 49.4567, 36.8511, "Харківська", "місто", 27000)
        
        # ========== СЕЛА ТА СЕЛИЩА ДОНЕЦЬКОЇ ОБЛАСТІ ==========
        # Додаткові населені пункти околиць Слов'янська
        self._add_settlement("Барвінкове", 48.9000, 37.5000, "Донецька", "село", 950)
        self._add_settlement("Веселе", 48.8833, 37.6833, "Донецька", "село", 850)
        self._add_settlement("Володимирівка", 48.9333, 37.6667, "Донецька", "село", 1100)
        self._add_settlement("Горлівка (село)", 48.8500, 37.5667, "Донецька", "село", 1400)
        self._add_settlement("Заможне", 48.9167, 37.5833, "Донецька", "село", 1200)
        self._add_settlement("Зоряне", 48.9000, 37.6333, "Донецька", "село", 1000)
        self._add_settlement("Калинівка", 48.9500, 37.6000, "Донецька", "село", 750)
        self._add_settlement("Комунар", 48.8667, 37.5333, "Донецька", "селище", 3200)
        self._add_settlement("Красний Лиман", 48.9667, 37.7167, "Донецька", "село", 650)
        self._add_settlement("Лісне", 48.9000, 37.6833, "Донецька", "село", 800)
        self._add_settlement("Майдан", 48.9333, 37.6167, "Донецька", "село", 900)
        self._add_settlement("Новоселівка", 48.8833, 37.6667, "Донецька", "село", 1150)
        self._add_settlement("Олександрівка (Слов'янськ)", 48.9000, 37.5833, "Донецька", "село", 1300)
        self._add_settlement("Підгірне", 48.9167, 37.6000, "Донецька", "село", 950)
        self._add_settlement("Пролетарське", 48.8667, 37.5833, "Донецька", "селище", 2800)
        self._add_settlement("Соснівка", 48.9500, 37.6667, "Донецька", "село", 850)
        self._add_settlement("Троїцьке", 48.9167, 37.7000, "Донецька", "село", 1050)
        self._add_settlement("Червоний Прапор", 48.8833, 37.7167, "Донецька", "селище", 1900)
        self._add_settlement("Шевченка", 48.9333, 37.7000, "Донецька", "село", 1250)
        
                # ========== СЛОВ'ЯНСЬКА МІСЬКА ГРОМАДА ==========
        self._add_settlement("Оріхуватка", 48.8908, 37.6017, "Донецька", "село", 3500)
        self._add_settlement("Теплянка", 48.8750, 37.5750, "Донецька", "село", 2800)
        self._add_settlement("Рай-Олександрівка", 48.9681, 37.6611, "Донецька", "село", 2200)
        self._add_settlement("Михайлівка", 48.9069, 37.6861, "Донецька", "село", 1800)
        self._add_settlement("Червоний Шахтар", 48.8669, 37.5469, "Донецька", "селище", 4200)
        self._add_settlement("Слов'янська Січ", 48.8569, 37.6208, "Донецька", "селище", 3100)
        self._add_settlement("Залізничне", 48.8369, 37.5711, "Донецька", "селище", 2500)
        self._add_settlement("Новоселівка (Оріхуватська)", 48.9028, 37.6250, "Донецька", "село", 1500)
        self._add_settlement("Водяне", 48.9167, 37.5833, "Донецька", "село", 1200)
        self._add_settlement("Зарічне", 48.9067, 37.5900, "Донецька", "село", 1100)
        self._add_settlement("Лісове", 48.8950, 37.5750, "Донецька", "село", 900)
        self._add_settlement("Підлісне", 48.8856, 37.5958, "Донецька", "село", 850)
        self._add_settlement("Соснове", 48.9056, 37.6150, "Донецька", "село", 950)
        self._add_settlement("Улянівка", 48.8933, 37.5858, "Донецька", "село", 800)
        self._add_settlement("Червоний Яр", 48.9008, 37.5789, "Донецька", "село", 700)
        
        # ========== ДРУГІ НАСЕЛЕНІ ПУНКТИ СЛОВ'ЯНСЬКОГО РАЙОНУ ==========
        self._add_settlement("Богородичне", 48.8500, 37.5000, "Донецька", "село", 2400)
        self._add_settlement("Бразолове", 48.8333, 37.5333, "Донецька", "село", 1800)
        self._add_settlement("Долина", 48.8667, 37.5333, "Донецька", "село", 1600)
        self._add_settlement("Кам'янка (Слов'янський район)", 48.9167, 37.4333, "Донецька", "село", 1400)
        self._add_settlement("Мазанівка", 48.8833, 37.4667, "Донецька", "село", 1900)
        self._add_settlement("Нова Дмитрівка", 48.9000, 37.4833, "Донецька", "село", 1300)
        self._add_settlement("Новоандріївка", 48.8500, 37.4500, "Донецька", "село", 1700)
        self._add_settlement("Новоолександрівка", 48.8667, 37.4667, "Донецька", "село", 1500)
        self._add_settlement("Олексіївка", 48.8333, 37.4833, "Донецька", "село", 1200)
        self._add_settlement("Петрівське (Слов'янський район)", 48.9000, 37.4333, "Донецька", "село", 1100)
        self._add_settlement("Прелесне", 48.8833, 37.4833, "Донецька", "село", 1000)
        self._add_settlement("Райгородок (Слов'янський район)", 48.8167, 37.5000, "Донецька", "село", 2100)
        self._add_settlement("Семенівка (Слов'янський район)", 48.8667, 37.4500, "Донецька", "село", 1400)
        self._add_settlement("Софіївка (Слов'янський район)", 48.8500, 37.4667, "Донецька", "село", 1600)
        self._add_settlement("Шевченка (Слов'янський район)", 48.8333, 37.4500, "Донецька", "село", 1300)
        
        # ========== КРАМАТОРСЬКА МІСЬКА ГРОМАДА ==========
        self._add_settlement("Іллінка", 48.7442, 37.6000, "Донецька", "село", 3200)
        self._add_settlement("Новодонецьке", 48.6333, 37.4833, "Донецька", "селище", 4100)
        self._add_settlement("Сергіївка", 48.7050, 37.5333, "Донецька", "село", 2800)
        self._add_settlement("Софіївка (Краматорський район)", 48.7167, 37.4500, "Донецька", "село", 2400)
        self._add_settlement("Шевченка (Краматорський район)", 48.6833, 37.4333, "Донецька", "село", 1900)
        self._add_settlement("Берестовенька", 48.6561, 37.5228, "Донецька", "село", 2200)
        self._add_settlement("Весела Долина", 48.6356, 37.5389, "Донецька", "селище", 3500)
        self._add_settlement("Гірницьке", 48.6986, 37.5806, "Донецька", "селище", 3900)
        self._add_settlement("Дружне", 48.6461, 37.5667, "Донецька", "селище", 3100)
        self._add_settlement("Затишшя", 48.6583, 37.5833, "Донецька", "село", 1800)
        self._add_settlement("Калинівка (Краматорський район)", 48.6250, 37.5208, "Донецька", "село", 1600)
        self._add_settlement("Комуна", 48.6731, 37.5389, "Донецька", "селище", 2700)
        self._add_settlement("Мирне (Краматорський район)", 48.6450, 37.5556, "Донецька", "село", 1400)
        self._add_settlement("Новоіванівка", 48.6389, 37.5778, "Донецька", "село", 1300)
        self._add_settlement("Оріхове", 48.6150, 37.5889, "Донецька", "село", 1100)
        self._add_settlement("Першотравневе", 48.6267, 37.6000, "Донецька", "село", 1200)
        self._add_settlement("Петрівське (Краматорський район)", 48.6036, 37.6111, "Донецька", "село", 1500)
        self._add_settlement("Піщане", 48.5928, 37.6222, "Донецька", "село", 1700)
        self._add_settlement("Поділля", 48.5833, 37.6333, "Донецька", "село", 1900)
        self._add_settlement("Пролісне", 48.5750, 37.6444, "Донецька", "село", 1600)
        self._add_settlement("Світле", 48.5667, 37.6556, "Донецька", "селище", 3300)
        self._add_settlement("Тарасівка", 48.5583, 37.6667, "Донецька", "село", 1400)
        self._add_settlement("Урожайне", 48.5500, 37.6778, "Донецька", "село", 1200)
        self._add_settlement("Федорівка", 48.5417, 37.6889, "Донецька", "село", 1300)
        self._add_settlement("Хлібодарівка", 48.5333, 37.7000, "Донецька", "село", 1500)
        self._add_settlement("Цвіточе", 48.5250, 37.7111, "Донецька", "селище", 3800)
        self._add_settlement("Червоне", 48.5167, 37.7222, "Донецька", "село", 1100)
        self._add_settlement("Широке", 48.5083, 37.7333, "Донецька", "село", 1400)
        self._add_settlement("Яблуневе (Краматорський район)", 48.5000, 37.7444, "Донецька", "село", 1300)
        self._add_settlement("Ясне", 48.4917, 37.7556, "Донецька", "село", 1200)
        
        # Додаткові населені пункти околиць Краматорська
        self._add_settlement("Андріївка (Краматорськ)", 48.7833, 37.5333, "Донецька", "село", 1400)
        self._add_settlement("Берестове", 48.7167, 37.5667, "Донецька", "село", 1100)
        self._add_settlement("Богданівка", 48.7333, 37.6500, "Донецька", "село", 1300)
        self._add_settlement("Василівка", 48.7000, 37.6000, "Донецька", "село", 1050)
        self._add_settlement("Весняне", 48.7667, 37.6167, "Донецька", "селище", 2100)
        self._add_settlement("Вільне", 48.6833, 37.5500, "Донецька", "село", 950)
        self._add_settlement("Гірське", 48.7500, 37.6833, "Донецька", "селище", 3400)
        self._add_settlement("Дмитрівка (Краматорськ)", 48.7333, 37.5667, "Донецька", "село", 1200)
        self._add_settlement("Дубове", 48.6833, 37.6333, "Донецька", "село", 850)
        self._add_settlement("Жовтневе", 48.7667, 37.5333, "Донецька", "селище", 2700)
        self._add_settlement("Затишне", 48.7167, 37.6833, "Донецька", "село", 1150)
        self._add_settlement("Калинове", 48.7000, 37.5667, "Донецька", "село", 900)
        self._add_settlement("Київка", 48.7333, 37.6000, "Донецька", "селище", 3100)
        self._add_settlement("Кленове", 48.6833, 37.6000, "Донецька", "село", 1000)
        self._add_settlement("Комуна", 48.7500, 37.5500, "Донецька", "селище", 2500)
        self._add_settlement("Ленінське", 48.7167, 37.6167, "Донецька", "селище", 3800)
        self._add_settlement("Мирне", 48.6833, 37.5667, "Донецька", "село", 1100)
        self._add_settlement("Надія", 48.7000, 37.6500, "Донецька", "село", 950)
        self._add_settlement("Новоолександрівка", 48.7500, 37.5833, "Донецька", "село", 1350)
        self._add_settlement("Орлівка", 48.6833, 37.5833, "Донецька", "село", 1200)
        self._add_settlement("Первомайське (Краматорськ)", 48.7667, 37.6000, "Донецька", "селище", 2900)
        self._add_settlement("Петрівське", 48.7000, 37.5833, "Донецька", "село", 1050)
        self._add_settlement("Подільське", 48.7333, 37.5333, "Донецька", "село", 1250)
        self._add_settlement("Прогрес", 48.6833, 37.6167, "Донецька", "селище", 2200)
        self._add_settlement("Роздолля", 48.7167, 37.5333, "Донецька", "село", 1150)
        self._add_settlement("Садки", 48.7500, 37.6333, "Донецька", "селище", 2600)
        self._add_settlement("Світанок", 48.6833, 37.6500, "Донецька", "село", 900)
        self._add_settlement("Сонячне", 48.7667, 37.6500, "Донецька", "селище", 2400)
        self._add_settlement("Українка", 48.7167, 37.6000, "Донецька", "селище", 3200)
        self._add_settlement("Фрунзе", 48.6833, 37.5333, "Донецька", "селище", 1900)
        self._add_settlement("Холодне", 48.7000, 37.6833, "Донецька", "село", 850)
        self._add_settlement("Цвіткове", 48.7333, 37.6667, "Донецька", "селище", 3000)
        self._add_settlement("Ювілейне", 48.6833, 37.5667, "Донецька", "селище", 1800)
        self._add_settlement("Яблуневе", 48.7000, 37.6167, "Донецька", "село", 1100)
        
        # ========== РАЙОННІ ЦЕНТРИ ТА ІНШІ ВАЖЛИВІ МІСТА ==========
        # Дніпропетровська область
        self._add_settlement("Новомосковськ", 48.6333, 35.2167, "Дніпропетровська", "місто", 72000)
        self._add_settlement("Жовті Води", 48.3500, 33.5167, "Дніпропетровська", "місто", 45000)
        self._add_settlement("Марганець", 47.6472, 34.6175, "Дніпропетровська", "місто", 46000)
        self._add_settlement("Синельникове", 48.3183, 35.5100, "Дніпропетровська", "місто", 32000)
        
        # Запорізька область
        self._add_settlement("Енергодар", 47.4989, 34.6558, "Запорізька", "місто", 53000)
        self._add_settlement("Токмак", 47.2500, 35.7000, "Запорізька", "місто", 32000)
        
        # Львівська область
        self._add_settlement("Борислав", 49.2867, 23.4236, "Львівська", "місто", 33000)
        self._add_settlement("Стрий", 49.2553, 23.8506, "Львівська", "місто", 59000)
        self._add_settlement("Трускавець", 49.2806, 23.5056, "Львівська", "місто", 29000)
        
        # Одеська область
        self._add_settlement("Чорноморськ", 46.3011, 30.6564, "Одеська", "місто", 60000)
        self._add_settlement("Білгород-Дністровський", 46.1833, 30.3333, "Одеська", "місто", 50000)
        self._add_settlement("Южне", 46.6231, 31.1011, "Одеська", "місто", 32000)
        
        # Харківська область
        self._add_settlement("Мерефа", 49.8200, 36.0700, "Харківська", "місто", 23000)
        self._add_settlement("Південне", 49.8833, 36.0667, "Харківська", "місто", 8000)
        self._add_settlement("Куп'янськ", 49.7064, 37.6167, "Харківська", "місто", 28000)
        
        # Черкаська область
        self._add_settlement("Умань", 48.7500, 30.2167, "Черкаська", "місто", 82000)
        self._add_settlement("Сміла", 49.2167, 31.8667, "Черкаська", "місто", 68000)
        
        # Чернігівська область
        self._add_settlement("Ніжин", 51.0478, 31.8867, "Чернігівська", "місто", 71000)
        self._add_settlement("Прилуки", 50.5928, 32.3875, "Чернігівська", "місто", 57000)
        
        # Вінницька область
        self._add_settlement("Хмільник", 49.5500, 27.9667, "Вінницька", "місто", 27000)
        self._add_settlement("Жмеринка", 49.0389, 28.1056, "Вінницька", "місто", 34000)
        
        # Івано-Франківська область
        self._add_settlement("Коломия", 48.5303, 25.0364, "Івано-Франківська", "місто", 61000)
        self._add_settlement("Калуш", 49.0433, 24.3600, "Івано-Франківська", "місто", 67000)
        
        # Тернопільська область
        self._add_settlement("Чортків", 49.0167, 25.8000, "Тернопільська", "місто", 29000)
        self._add_settlement("Бережани", 49.4444, 24.9389, "Тернопільська", "місто", 17000)
        
        # Хмельницька область
        self._add_settlement("Шепетівка", 50.1833, 27.0667, "Хмельницька", "місто", 41000)
        self._add_settlement("Старокостянтинів", 49.7556, 27.2125, "Хмельницька", "місто", 34000)
        
        # Рівненська область
        self._add_settlement("Дубно", 50.3931, 25.7547, "Рівненська", "місто", 38000)
        self._add_settlement("Костопіль", 50.8833, 26.4333, "Рівненська", "місто", 31000)
        
        # Волинська область
        self._add_settlement("Ковель", 51.2167, 24.7167, "Волинська", "місто", 69000)
        self._add_settlement("Нововолинськ", 50.7333, 24.1667, "Волинська", "місто", 53000)
        
        # Закарпатська область
        self._add_settlement("Мукачево", 48.4414, 22.7136, "Закарпатська", "місто", 86000)
        self._add_settlement("Хуст", 48.1817, 23.2978, "Закарпатська", "місто", 29000)
        
        # Кіровоградська область
        self._add_settlement("Олександрія", 48.6667, 33.1167, "Кіровоградська", "місто", 82000)
        self._add_settlement("Світловодськ", 49.0833, 33.2500, "Кіровоградська", "місто", 47000)
        
        # Полтавська область
        self._add_settlement("Лубни", 50.0167, 33.0000, "Полтавська", "місто", 46000)
        self._add_settlement("Горішні Плавні", 49.0106, 33.6444, "Полтавська", "місто", 51000)
        
        # Сумська область
        self._add_settlement("Шостка", 51.8667, 33.4833, "Сумська", "місто", 77000)
        self._add_settlement("Конотоп", 51.2369, 33.2028, "Сумська", "місто", 88000)
        
        # Херсонська область
        self._add_settlement("Нова Каховка", 46.7500, 33.3667, "Херсонська", "місто", 45000)
        self._add_settlement("Каховка", 46.8000, 33.4667, "Херсонська", "місто", 36000)
        
        # Луганська область
        self._add_settlement("Алчевськ", 48.4667, 38.8000, "Луганська", "місто", 110000)
        self._add_settlement("Сєвєродонецьк", 48.9475, 38.4933, "Луганська", "місто", 103000)
        self._add_settlement("Лисичанськ", 48.9167, 38.4333, "Луганська", "місто", 103000)
        
        # АР Крим
        self._add_settlement("Ялта", 44.4994, 34.1553, "АР Крим", "місто", 79000)
        self._add_settlement("Феодосія", 45.0489, 35.3792, "АР Крим", "місто", 69000)
        self._add_settlement("Саки", 45.1336, 33.5772, "АР Крим", "місто", 25000)
        
        print(f"✅ Завантажено {sum(len(v) for v in self.settlements.values())} записів про населені пункти")
    
    def _add_settlement(self, name: str, lat: float, lon: float, region: str, 
                       settlement_type: str, population: int = 0):
        """Додати населений пункт до бази"""
        if name not in self.settlements:
            self.settlements[name] = []
        
        self.settlements[name].append({
            'lat': lat,
            'lon': lon,
            'region': region,
            'type': settlement_type,
            'population': population
        })
    
    def find_settlements_by_prefix(self, prefix: str, limit: int = 30) -> List[dict]:
        """Знайти населені пункти за першими символами"""
        prefix_lower = prefix.lower()
        results = []
        
        for settlement_name, settlements_list in self.settlements.items():
            if settlement_name.lower().startswith(prefix_lower):
                for settlement in settlements_list:
                    results.append({
                        'name': settlement_name,
                        'full_name': f"{settlement_name} ({settlement['region']})",
                        'region': settlement['region'],
                        'lat': settlement['lat'],
                        'lon': settlement['lon'],
                        'type': settlement['type'],
                        'population': settlement.get('population', 0)
                    })
        
        # Сортуємо за населенням (більші першими), потім за назвою
        results.sort(key=lambda x: (x['population'], x['name']), reverse=True)
        
        return results[:limit]
    
    def find_settlements_by_name(self, name: str, region: str = None) -> List[dict]:
        """Знайти населені пункти за точним іменем"""
        name_lower = name.lower()
        results = []
        
        for settlement_name, settlements_list in self.settlements.items():
            if settlement_name.lower() == name_lower:
                for settlement in settlements_list:
                    if region is None or settlement['region'].lower() == region.lower():
                        results.append({
                            'name': settlement_name,
                            'full_name': f"{settlement_name} ({settlement['region']})",
                            'region': settlement['region'],
                            'lat': settlement['lat'],
                            'lon': settlement['lon'],
                            'type': settlement['type'],
                            'population': settlement.get('population', 0)
                        })
        
        return results
    
    def get_all_regions(self) -> List[str]:
        """Отримати список усіх областей"""
        regions = set()
        for settlements_list in self.settlements.values():
            for settlement in settlements_list:
                regions.add(settlement['region'])
        return sorted(list(regions))
    
    def get_regional_centers(self) -> List[dict]:
        """Отримати список обласних центрів"""
        centers = []
        for name, settlements_list in self.settlements.items():
            for settlement in settlements_list:
                if settlement['type'] in ['обласний центр', 'столиця']:
                    centers.append({
                        'name': name,
                        'region': settlement['region'],
                        'population': settlement.get('population', 0),
                        'lat': settlement['lat'],
                        'lon': settlement['lon']
                    })
                    break
        
        centers.sort(key=lambda x: x['name'])
        return centers
    
    def get_statistics(self) -> dict:
        """Отримати статистику бази даних"""
        total_entries = sum(len(v) for v in self.settlements.values())
        
        regions = {}
        types = {}
        
        for settlements_list in self.settlements.values():
            for settlement in settlements_list:
                region = settlement['region']
                settlement_type = settlement['type']
                
                regions[region] = regions.get(region, 0) + 1
                types[settlement_type] = types.get(settlement_type, 0) + 1
        
        all_settlements = []
        for name, settlements_list in self.settlements.items():
            for settlement in settlements_list:
                if settlement.get('population', 0) > 0:
                    all_settlements.append({
                        'name': name,
                        'region': settlement['region'],
                        'population': settlement['population'],
                        'type': settlement['type']
                    })
        
        all_settlements.sort(key=lambda x: x['population'], reverse=True)
        largest_cities = all_settlements[:10]
        
        duplicates = [name for name, lst in self.settlements.items() if len(lst) > 1]
        
        return {
            'unique_names': len(self.settlements),
            'total_entries': total_entries,
            'regions_count': len(regions),
            'regions_distribution': regions,
            'types_distribution': types,
            'largest_cities': largest_cities,
            'duplicates': duplicates,
            'duplicates_count': len(duplicates)
        }
    
    def get_coordinates(self, settlement_name: str, region: str = None) -> Tuple[Optional[float], Optional[float]]:
        """Отримати координати населеного пункту"""
        if settlement_name not in self.settlements:
            return None, None
        
        settlements = self.settlements[settlement_name]
        
        if len(settlements) == 1:
            return settlements[0]['lat'], settlements[0]['lon']
        
        if region:
            for settlement in settlements:
                if settlement['region'].lower() == region.lower():
                    return settlement['lat'], settlement['lon']
        
        return settlements[0]['lat'], settlements[0]['lon']

# Глобальний екземпляр бази даних
settlements_db = UkraineSettlementsDB()
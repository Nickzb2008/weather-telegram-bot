# settlements_db.py
import json
import os
from typing import Dict, List, Optional, Tuple

class UkraineSettlementsDB:
    def __init__(self, db_file: str = None):
        self.settlements = {}
        if db_file and os.path.exists(db_file):
            self.load_from_file(db_file)
        else:
            self.load_default_data()
    
    def load_default_data(self):
        """Завантаження повної бази населених пунктів України"""
        # Автономна Республіка Крим
        self._add_settlement("Алупка", 44.4181, 34.0450, "АР Крим", "місто", 7800)
        self._add_settlement("Алушта", 44.6672, 34.3978, "АР Крим", "місто", 28400)
        self._add_settlement("Армянськ", 46.1089, 33.6920, "АР Крим", "місто", 22000)
        self._add_settlement("Бахчисарай", 44.7528, 33.8608, "АР Крим", "місто", 27400)
        self._add_settlement("Білогірськ", 45.0542, 34.6022, "АР Крим", "місто", 16300)
        self._add_settlement("Джанкой", 45.7086, 34.3933, "АР Крим", "місто", 38600)
        self._add_settlement("Євпаторія", 45.1906, 33.3675, "АР Крим", "місто", 106000)
        self._add_settlement("Керч", 45.3567, 36.4758, "АР Крим", "місто", 147000)
        self._add_settlement("Красноперекопськ", 45.9581, 33.7964, "АР Крим", "місто", 26000)
        self._add_settlement("Саки", 45.1336, 33.5772, "АР Крим", "місто", 25100)
        self._add_settlement("Сімферополь", 44.9521, 34.1024, "АР Крим", "обласний центр", 332000)
        self._add_settlement("Судак", 44.8514, 34.9725, "АР Крим", "місто", 16500)
        self._add_settlement("Феодосія", 45.0489, 35.3792, "АР Крим", "місто", 69000)
        self._add_settlement("Щолкіно", 45.4281, 35.8250, "АР Крим", "місто", 10800)
        self._add_settlement("Ялта", 44.5022, 34.1664, "АР Крим", "місто", 79000)
        
        # Вінницька область
        self._add_settlement("Бар", 49.0769, 27.6825, "Вінницька", "місто", 16000)
        self._add_settlement("Бершадь", 48.3758, 29.5333, "Вінницька", "місто", 13000)
        self._add_settlement("Вінниця", 49.2328, 28.4816, "Вінницька", "обласний центр", 369000)
        self._add_settlement("Гайсин", 48.8083, 29.3867, "Вінницька", "місто", 25900)
        self._add_settlement("Гнівань", 49.0833, 28.3500, "Вінницька", "місто", 12100)
        self._add_settlement("Жмеринка", 49.0375, 28.1122, "Вінницька", "місто", 35000)
        self._add_settlement("Іллінці", 49.1039, 29.2200, "Вінницька", "місто", 11300)
        self._add_settlement("Калинівка", 49.4475, 28.5247, "Вінницька", "місто", 19500)
        self._add_settlement("Козятин", 49.7133, 28.8336, "Вінницька", "місто", 23300)
        self._add_settlement("Ладижин", 48.6681, 29.2419, "Вінницька", "місто", 22300)
        self._add_settlement("Могилів-Подільський", 48.4478, 27.7933, "Вінницька", "місто", 31900)
        self._add_settlement("Немирів", 48.9767, 28.8436, "Вінницька", "місто", 11800)
        self._add_settlement("Погребище", 49.4833, 29.2667, "Вінницька", "місто", 9600)
        self._add_settlement("Тульчин", 48.6750, 28.8481, "Вінницька", "місто", 15400)
        self._add_settlement("Хмільник", 49.5589, 27.9633, "Вінницька", "місто", 27600)
        
        # Волинська область
        self._add_settlement("Володимир", 50.8478, 24.3222, "Волинська", "місто", 38000)
        self._add_settlement("Горохів", 50.5000, 24.7667, "Волинська", "місто", 9000)
        self._add_settlement("Камінь-Каширський", 51.6242, 24.9606, "Волинська", "місто", 10300)
        self._add_settlement("Ківерці", 50.8333, 25.4667, "Волинська", "місто", 13400)
        self._add_settlement("Ковель", 51.2150, 24.7167, "Волинська", "місто", 69000)
        self._add_settlement("Луцьк", 50.7472, 25.3254, "Волинська", "обласний центр", 217000)
        self._add_settlement("Любомль", 51.2261, 24.0372, "Волинська", "місто", 10300)
        self._add_settlement("Нововолинськ", 50.7333, 24.1667, "Волинська", "місто", 52000)
        self._add_settlement("Рожище", 50.9167, 25.2667, "Волинська", "місто", 13100)
        self._add_settlement("Устилуг", 50.8600, 24.1578, "Волинська", "місто", 2100)
        
        # Дніпропетровська область
        self._add_settlement("Апостолове", 47.6600, 33.7139, "Дніпропетровська", "місто", 14800)
        self._add_settlement("Верхньодніпровськ", 48.6564, 34.3281, "Дніпропетровська", "місто", 16400)
        self._add_settlement("Вільногірськ", 48.4794, 34.0181, "Дніпропетровська", "місто", 23500)
        self._add_settlement("Дніпро", 48.4647, 35.0462, "Дніпропетровська", "обласний центр", 966000)
        self._add_settlement("Жовті Води", 48.3500, 33.5167, "Дніпропетровська", "місто", 44400)
        self._add_settlement("Кам'янське", 48.5076, 34.6132, "Дніпропетровська", "місто", 235000)
        self._add_settlement("Кривий Ріг", 47.9105, 33.3918, "Дніпропетровська", "місто", 612000)
        self._add_settlement("Марганець", 47.6406, 34.6275, "Дніпропетровська", "місто", 46500)
        self._add_settlement("Нікополь", 47.5667, 34.4000, "Дніпропетровска", "місто", 110000)
        self._add_settlement("Новомосковськ", 48.6322, 35.2239, "Дніпропетровська", "місто", 70000)
        self._add_settlement("Підгородне", 48.5753, 35.0958, "Дніпропетровська", "місто", 19300)
        self._add_settlement("Павлоград", 48.5200, 35.8700, "Дніпропетровська", "місто", 105000)
        self._add_settlement("Перещепине", 48.7367, 35.3608, "Дніпропетровська", "місто", 10000)
        self._add_settlement("Першотравенськ", 48.3464, 36.4056, "Дніпропетровська", "місто", 28300)
        self._add_settlement("Синельникове", 48.3178, 35.5119, "Дніпропетровська", "місто", 30700)
        self._add_settlement("Тернівка", 48.5236, 36.0808, "Дніпропетровська", "місто", 29000)
        
        # Донецька область
        self._add_settlement("Авдіївка", 48.1333, 37.7500, "Донецька", "місто", 32000)
        self._add_settlement("Бахмут", 48.5953, 38.0000, "Донецька", "місто", 72000)
        self._add_settlement("Волноваха", 47.6011, 37.4964, "Донецька", "місто", 21700)
        self._add_settlement("Горлівка", 48.3056, 38.0297, "Донецька", "місто", 242000)
        self._add_settlement("Дебальцеве", 48.3333, 38.4000, "Донецька", "місто", 25000)
        self._add_settlement("Добропілля", 48.4667, 37.0833, "Донецька", "місто", 29200)
        self._add_settlement("Докучаєвськ", 47.7500, 37.6833, "Донецька", "місто", 23900)
        self._add_settlement("Донецьк", 48.0159, 37.8028, "Донецька", "обласний центр", 901000)
        self._add_settlement("Дружківка", 48.6167, 37.5333, "Донецька", "місто", 59000)
        self._add_settlement("Єнакієве", 48.2311, 38.2053, "Донецька", "місто", 79300)
        self._add_settlement("Жданівка", 48.1333, 38.2500, "Донецька", "місто", 12000)
        self._add_settlement("Костянтинівка", 48.5278, 37.7056, "Донецька", "місто", 70000)
        self._add_settlement("Краматорськ", 48.7392, 37.5839, "Донецька", "місто", 157000)
        self._add_settlement("Лиман", 48.9833, 37.8167, "Донецька", "місто", 22000)
        self._add_settlement("Макіївка", 48.0556, 38.0647, "Донецька", "місто", 344000)
        self._add_settlement("Маріуполь", 47.0971, 37.5434, "Донецька", "місто", 431000)
        self._add_settlement("Новоазовськ", 47.1167, 38.0833, "Донецька", "місто", 11700)
        self._add_settlement("Покровськ", 48.2833, 37.1833, "Донецька", "місто", 63600)
        self._add_settlement("Селидове", 48.1500, 37.3000, "Донецька", "місто", 22900)
        self._add_settlement("Слов'янськ", 48.8531, 37.6050, "Донецька", "місто", 106000)
        self._add_settlement("Сніжне", 48.0333, 38.7667, "Донецька", "місто", 47800)
        self._add_settlement("Торецьк", 48.3983, 37.8617, "Донецька", "місто", 34600)
        self._add_settlement("Харцизьк", 48.0333, 38.1500, "Донецька", "місто", 59000)
        self._add_settlement("Шахтарськ", 48.0333, 38.4833, "Донецька", "місто", 51800)
        self._add_settlement("Ясинувата", 48.1167, 37.8333, "Донецька", "місто", 35800)
        
        # Житомирська область
        self._add_settlement("Андрушівка", 50.0167, 29.0167, "Житомирська", "місто", 8900)
        self._add_settlement("Бердичів", 49.8917, 28.6000, "Житомирська", "місто", 75000)
        self._add_settlement("Житомир", 50.2547, 28.6587, "Житомирська", "обласний центр", 261000)
        self._add_settlement("Коростень", 50.9500, 28.6500, "Житомирська", "місто", 62000)
        self._add_settlement("Коростишів", 50.3167, 29.0667, "Житомирська", "місто", 25500)
        self._add_settlement("Малин", 50.7667, 29.2500, "Житомирська", "місто", 26900)
        self._add_settlement("Новоград-Волинський", 50.5833, 27.6333, "Житомирська", "місто", 56000)
        self._add_settlement("Овруч", 51.3247, 28.8072, "Житомирська", "місто", 16500)
        self._add_settlement("Олевськ", 51.2283, 27.6508, "Житомирська", "місто", 10300)
        self._add_settlement("Радомишль", 50.4947, 29.2336, "Житомирська", "місто", 14700)
        
        # Закарпатська область
        self._add_settlement("Берегове", 48.2044, 22.6386, "Закарпатська", "місто", 23000)
        self._add_settlement("Виноградів", 48.1400, 23.0386, "Закарпатська", "місто", 25500)
        self._add_settlement("Іршава", 48.3167, 23.0389, "Закарпатська", "місто", 9300)
        self._add_settlement("Міжгір'я", 48.5286, 23.5014, "Закарпатська", "селище міського типу", 9800)
        self._add_settlement("Мукачево", 48.4412, 22.7176, "Закарпатська", "місто", 85000)
        self._add_settlement("Перечин", 48.7333, 22.4833, "Закарпатська", "місто", 6800)
        self._add_settlement("Рахів", 48.0500, 24.2167, "Закарпатська", "місто", 15600)
        self._add_settlement("Свалява", 48.5486, 22.9872, "Закарпатська", "місто", 17000)
        self._add_settlement("Тячів", 48.0117, 23.5722, "Закарпатська", "місто", 9000)
        self._add_settlement("Ужгород", 48.6208, 22.2879, "Закарпатська", "обласний центр", 115000)
        self._add_settlement("Хуст", 48.1761, 23.2994, "Закарпатська", "місто", 29000)
        self._add_settlement("Чоп", 48.4333, 22.2000, "Закарпатська", "місто", 8800)
        
        # Запорізька область
        self._add_settlement("Бердянськ", 46.7590, 36.7869, "Запорізька", "місто", 107000)
        self._add_settlement("Василівка", 47.4333, 35.2833, "Запорізька", "місто", 13500)
        self._add_settlement("Вільнянськ", 47.9436, 35.4353, "Запорізька", "місто", 15300)
        self._add_settlement("Гуляйполе", 47.6633, 36.2614, "Запорізька", "місто", 14700)
        self._add_settlement("Дніпрорудне", 47.3833, 34.9833, "Запорізька", "місто", 19000)
        self._add_settlement("Енергодар", 47.4989, 34.6558, "Запорізька", "місто", 53000)
        self._add_settlement("Запоріжжя", 47.8229, 35.1903, "Запорізька", "обласний центр", 722000)
        self._add_settlement("Кам'янка-Дніпровська", 47.4833, 34.4167, "Запорізька", "місто", 13700)
        self._add_settlement("Мелітополь", 46.8489, 35.3653, "Запорізька", "місто", 150000)
        self._add_settlement("Молочанськ", 47.2067, 35.5958, "Запорізька", "місто", 6900)
        self._add_settlement("Оріхів", 47.5678, 35.7853, "Запорізька", "місто", 15400)
        self._add_settlement("Пологі", 47.4764, 36.2531, "Запорізька", "місто", 20000)
        self._add_settlement("Приморськ", 46.7333, 36.3500, "Запорізька", "місто", 11800)
        self._add_settlement("Токмак", 47.2500, 35.7167, "Запорізька", "місто", 32300)
        
        # Івано-Франківська область
        self._add_settlement("Болехів", 49.0667, 23.8500, "Івано-Франківська", "місто", 10700)
        self._add_settlement("Бурштин", 49.2586, 24.6347, "Івано-Франківська", "місто", 15400)
        self._add_settlement("Галич", 49.1167, 24.7167, "Івано-Франківська", "місто", 6200)
        self._add_settlement("Городенка", 48.6667, 25.5000, "Івано-Франківська", "місто", 9400)
        self._add_settlement("Долина", 48.9700, 24.0100, "Івано-Франківська", "місто", 20600)
        self._add_settlement("Івано-Франківськ", 48.9226, 24.7111, "Івано-Франківська", "обласний центр", 238000)
        self._add_settlement("Калуш", 49.0428, 24.3608, "Івано-Франківська", "місто", 65000)
        self._add_settlement("Коломия", 48.5306, 25.0403, "Івано-Франківська", "місто", 61000)
        self._add_settlement("Косів", 48.3167, 25.1000, "Івано-Франківська", "місто", 8300)
        self._add_settlement("Надвірна", 48.6333, 24.5833, "Івано-Франківська", "місто", 22200)
        self._add_settlement("Рогатин", 49.4167, 24.6167, "Івано-Франківська", "місто", 8100)
        self._add_settlement("Снятин", 48.4500, 25.5667, "Івано-Франківська", "місто", 9900)
        self._add_settlement("Тисмениця", 48.9000, 24.8500, "Івано-Франківська", "місто", 9300)
        self._add_settlement("Тлумач", 48.8667, 25.0000, "Івано-Франківська", "місто", 8900)
        self._add_settlement("Яремче", 48.4547, 24.5550, "Івано-Франківська", "місто", 8000)
        
        # Київська область
        self._add_settlement("Березань", 50.3194, 31.4700, "Київська", "місто", 16700)
        self._add_settlement("Біла Церква", 49.7956, 30.1167, "Київська", "місто", 208000)
        self._add_settlement("Богуслав", 49.5467, 30.8744, "Київська", "місто", 16200)
        self._add_settlement("Бориспіль", 50.3528, 30.9550, "Київська", "місто", 63000)
        self._add_settlement("Боярка", 50.3300, 30.2889, "Київська", "місто", 35000)
        self._add_settlement("Бровари", 50.5114, 30.7903, "Київська", "місто", 109000)
        self._add_settlement("Буча", 50.5500, 30.2167, "Київська", "місто", 36000)
        self._add_settlement("Васильків", 50.1778, 30.3219, "Київська", "місто", 37700)
        self._add_settlement("Вишгород", 50.5850, 30.5000, "Київська", "місто", 29800)
        self._add_settlement("Вишневе", 50.3869, 30.3639, "Київська", "місто", 39000)
        self._add_settlement("Ірпінь", 50.5167, 30.2500, "Київська", "місто", 60000)
        self._add_settlement("Кагарлик", 49.8528, 30.8233, "Київська", "місто", 13700)
        self._add_settlement("Київ", 50.4501, 30.5234, "Київська", "столиця", 2967000)
        self._add_settlement("Обухів", 50.1100, 30.6328, "Київська", "місто", 33200)
        self._add_settlement("Переяслав", 50.0650, 31.4450, "Київська", "місто", 27000)
        self._add_settlement("Прип'ять", 51.4056, 30.0569, "Київська", "місто", 0)
        self._add_settlement("Ржищів", 49.9625, 31.0478, "Київська", "місто", 7600)
        self._add_settlement("Славутич", 51.5225, 30.7561, "Київська", "місто", 25000)
        self._add_settlement("Тараща", 49.5583, 30.5083, "Київська", "місто", 10900)
        self._add_settlement("Тетіїв", 49.3700, 29.6833, "Київська", "місто", 13300)
        self._add_settlement("Узин", 49.8217, 30.4381, "Київська", "місто", 11800)
        self._add_settlement("Українка", 50.1500, 30.7500, "Київська", "місто", 16000)
        self._add_settlement("Фастів", 50.0747, 29.9183, "Київська", "місто", 45000)
        self._add_settlement("Чорнобиль", 51.2717, 30.2247, "Київська", "місто", 0)
        self._add_settlement("Яготин", 50.2500, 31.7833, "Київська", "місто", 20300)
        
        # Кіровоградська область (Кропивницька)
        self._add_settlement("Бобринець", 48.0589, 32.1664, "Кіровоградська", "місто", 10800)
        self._add_settlement("Долинська", 48.1106, 32.7647, "Кіровоградська", "місто", 34200)
        self._add_settlement("Знам'янка", 48.7136, 32.6733, "Кіровоградська", "місто", 23000)
        self._add_settlement("Кропивницький", 48.5132, 32.2597, "Кіровоградська", "обласний центр", 222000)
        self._add_settlement("Мала Виска", 48.6500, 31.6333, "Кіровоградська", "місто", 10600)
        self._add_settlement("Новомиргород", 48.7833, 31.6500, "Кіровоградська", "місто", 11200)
        self._add_settlement("Новоукраїнка", 48.3167, 31.5333, "Кіровоградська", "місто", 17000)
        self._add_settlement("Олександрія", 48.6697, 33.1206, "Кіровоградська", "місто", 82000)
        self._add_settlement("Світловодськ", 49.0833, 33.2500, "Кіровоградська", "місто", 44000)
        
        # Львівська область
        self._add_settlement("Борислав", 49.2861, 23.4231, "Львівська", "місто", 33000)
        self._add_settlement("Броди", 50.0783, 25.1503, "Львівська", "місто", 23800)
        self._add_settlement("Буськ", 49.9667, 24.6167, "Львівська", "місто", 8700)
        self._add_settlement("Городок", 49.7833, 23.6500, "Львівська", "місто", 16000)
        self._add_settlement("Добромиль", 49.5667, 22.7833, "Львівська", "місто", 4700)
        self._add_settlement("Дрогобич", 49.3500, 23.5000, "Львівська", "місто", 74000)
        self._add_settlement("Жидачів", 49.3833, 24.1500, "Львівська", "місто", 10800)
        self._add_settlement("Жовква", 50.0667, 23.9667, "Львівська", "місто", 13500)
        self._add_settlement("Золочів", 49.8053, 24.8933, "Львівська", "місто", 24000)
        self._add_settlement("Кам'янка-Бузька", 50.1000, 24.3500, "Львівська", "місто", 10900)
        self._add_settlement("Львів", 49.8397, 24.0297, "Львівська", "обласний центр", 717000)
        self._add_settlement("Мостиська", 49.7931, 23.1525, "Львівська", "місто", 9100)
        self._add_settlement("Новий Калинів", 49.5708, 23.3056, "Львівська", "місто", 4200)
        self._add_settlement("Новий Розділ", 49.4700, 24.1300, "Львівська", "місто", 28000)
        self._add_settlement("Перемишляни", 49.6667, 24.5667, "Львівська", "місто", 6800)
        self._add_settlement("Пустомити", 49.7167, 23.9167, "Львівська", "місто", 10100)
        self._add_settlement("Рава-Руська", 50.2333, 23.6167, "Львівська", "місто", 8500)
        self._add_settlement("Радехів", 50.2833, 24.6333, "Львівська", "місто", 9300)
        self._add_settlement("Самбір", 49.5167, 23.2000, "Львівська", "місто", 34000)
        self._add_settlement("Сколе", 49.0333, 23.5167, "Львівська", "місто", 6200)
        self._add_settlement("Сокаль", 50.4833, 24.2833, "Львівська", "місто", 21000)
        self._add_settlement("Старий Самбір", 49.4500, 23.0000, "Львівська", "місто", 5700)
        self._add_settlement("Стрий", 49.2553, 23.8506, "Львівська", "місто", 59000)
        self._add_settlement("Трускавець", 49.2806, 23.5050, "Львівська", "місто", 29000)
        self._add_settlement("Угнів", 50.3667, 23.7500, "Львівська", "місто", 1000)
        self._add_settlement("Хирів", 49.5333, 22.8500, "Львівська", "місто", 4400)
        self._add_settlement("Червоноград", 50.3833, 24.2333, "Львівська", "місто", 65000)
        self._add_settlement("Яворів", 49.9500, 23.3833, "Львівська", "місто", 13000)
        
        # Миколаївська область
        self._add_settlement("Баштанка", 47.4069, 32.4450, "Миколаївська", "місто", 12600)
        self._add_settlement("Вознесенськ", 47.5667, 31.3333, "Миколаївська", "місто", 34000)
        self._add_settlement("Миколаїв", 46.9750, 31.9946, "Миколаївська", "обласний центр", 480000)
        self._add_settlement("Нова Одеса", 47.3167, 31.7833, "Миколаївська", "місто", 12000)
        self._add_settlement("Новий Буг", 47.6833, 32.5167, "Миколаївська", "місто", 15100)
        self._add_settlement("Очаків", 46.6167, 31.5500, "Миколаївська", "місто", 14000)
        self._add_settlement("Первомайськ", 48.0500, 30.8500, "Миколаївська", "місто", 66000)
        self._add_settlement("Снігурівка", 47.0764, 32.8056, "Миколаївська", "місто", 12400)
        self._add_settlement("Южноукраїнськ", 47.8208, 31.1775, "Миколаївська", "місто", 39000)
        
        # Одеська область
        self._add_settlement("Ананьїв", 47.7167, 29.9667, "Одеська", "місто", 8300)
        self._add_settlement("Арциз", 45.9928, 29.4181, "Одеська", "місто", 14400)
        self._add_settlement("Балта", 47.9333, 29.6167, "Одеська", "місто", 18000)
        self._add_settlement("Березівка", 47.2044, 30.9164, "Одеська", "місто", 9700)
        self._add_settlement("Білгород-Дністровський", 46.1833, 30.3333, "Одеська", "місто", 48000)
        self._add_settlement("Болград", 45.6833, 28.6167, "Одеська", "місто", 15500)
        self._add_settlement("Вилкове", 45.4000, 29.5833, "Одеська", "місто", 8200)
        self._add_settlement("Ізмаїл", 45.3500, 28.8333, "Одеська", "місто", 71000)
        self._add_settlement("Кілія", 45.4500, 29.2667, "Одеська", "місто", 20100)
        self._add_settlement("Кодима", 48.1000, 29.1167, "Одеська", "місто", 8600)
        self._add_settlement("Одеса", 46.4825, 30.7233, "Одеська", "обласний центр", 1017000)
        self._add_settlement("Рені", 45.4500, 28.2833, "Одеська", "місто", 18900)
        self._add_settlement("Роздільна", 46.8500, 30.0833, "Одеська", "місто", 17600)
        self._add_settlement("Татарбунари", 45.8417, 29.6167, "Одеська", "місто", 10700)
        self._add_settlement("Теплодар", 46.5000, 30.3167, "Одеська", "місто", 10000)
        self._add_settlement("Чорноморськ", 46.3011, 30.6569, "Одеська", "місто", 59000)
        self._add_settlement("Южне", 46.6217, 31.1011, "Одеська", "місто", 32000)
        
        # Полтавська область
        self._add_settlement("Гадяч", 50.3667, 33.9833, "Полтавська", "місто", 22000)
        self._add_settlement("Глобине", 49.3833, 33.2833, "Полтавська", "місто", 9500)
        self._add_settlement("Горішні Плавні", 49.0094, 33.6450, "Полтавська", "місто", 50000)
        self._add_settlement("Гребінка", 50.1167, 32.4333, "Полтавська", "місто", 11000)
        self._add_settlement("Карлівка", 49.4500, 35.1333, "Полтавська", "місто", 15000)
        self._add_settlement("Кобеляки", 49.1500, 34.2167, "Полтавська", "місто", 10000)
        self._add_settlement("Комсомольськ", 49.0072, 33.6469, "Полтавська", "місто", 50000)
        self._add_settlement("Кременчук", 49.0667, 33.4167, "Полтавська", "місто", 217000)
        self._add_settlement("Лохвиця", 50.3603, 33.2656, "Полтавська", "місто", 11200)
        self._add_settlement("Лубни", 50.0167, 33.0000, "Полтавська", "місто", 45000)
        self._add_settlement("Миргород", 49.9667, 33.6000, "Полтавська", "місто", 39000)
        self._add_settlement("Пирятин", 50.2403, 32.5081, "Полтавська", "місто", 15600)
        self._add_settlement("Полтава", 49.5883, 34.5514, "Полтавська", "обласний центр", 279000)
        self._add_settlement("Решетилівка", 49.5667, 34.0667, "Полтавська", "місто", 9400)
        self._add_settlement("Хорол", 49.7833, 33.2500, "Полтавська", "місто", 13000)
        self._add_settlement("Чорнухи", 50.2833, 32.9500, "Полтавська", "селище міського типу", 2800)
        
        # Рівненська область
        self._add_settlement("Березне", 51.0000, 26.7500, "Рівненська", "місто", 13300)
        self._add_settlement("Вараш", 51.3333, 25.8500, "Рівненська", "місто", 42000)
        self._add_settlement("Дубно", 50.3939, 25.7592, "Рівненська", "місто", 37000)
        self._add_settlement("Дубровиця", 51.5667, 26.5667, "Рівненська", "місто", 9500)
        self._add_settlement("Зарічне", 51.8167, 26.1333, "Рівненська", "місто", 7600)
        self._add_settlement("Здолбунів", 50.5167, 26.2500, "Рівненська", "місто", 24000)
        self._add_settlement("Костопіль", 50.8833, 26.4333, "Рівненська", "місто", 31000)
        self._add_settlement("Острог", 50.3333, 26.5167, "Рівненська", "місто", 15200)
        self._add_settlement("Радивилів", 50.1333, 25.2667, "Рівненська", "місто", 10300)
        self._add_settlement("Рівне", 50.6199, 26.2516, "Рівненська", "обласний центр", 246000)
        self._add_settlement("Сарни", 51.3333, 26.6000, "Рівненська", "місто", 28400)
        
        # Сумська область
        self._add_settlement("Білопілля", 51.1500, 34.3000, "Сумська", "місто", 15800)
        self._add_settlement("Буринь", 51.1992, 33.8397, "Сумська", "місто", 8500)
        self._add_settlement("Ворожба", 51.0500, 34.2333, "Сумська", "місто", 7000)
        self._add_settlement("Глухів", 51.6781, 33.9167, "Сумська", "місто", 33000)
        self._add_settlement("Дружба", 52.0464, 33.9456, "Сумська", "місто", 4700)
        self._add_settlement("Конотоп", 51.2369, 33.2027, "Сумська", "місто", 84000)
        self._add_settlement("Кролевець", 51.5500, 33.3833, "Сумська", "місто", 22700)
        self._add_settlement("Лебедин", 50.5833, 34.4833, "Сумська", "місто", 25000)
        self._add_settlement("Охтирка", 50.3000, 34.9000, "Сумська", "місто", 47000)
        self._add_settlement("Путивль", 51.3333, 33.8667, "Сумська", "місто", 15500)
        self._add_settlement("Ромни", 50.7431, 33.4839, "Сумська", "місто", 38000)
        self._add_settlement("Середина-Буда", 52.1833, 34.0333, "Сумська", "місто", 7000)
        self._add_settlement("Суми", 50.9077, 34.7981, "Сумська", "обласний центр", 259000)
        self._add_settlement("Тростянець", 50.4764, 34.9656, "Сумська", "місто", 20300)
        self._add_settlement("Шостка", 51.8667, 33.4833, "Сумська", "місто", 73000)
        
        # Тернопільська область
        self._add_settlement("Бережани", 49.4500, 24.9333, "Тернопільська", "місто", 17000)
        self._add_settlement("Борщів", 48.8033, 26.0425, "Тернопільська", "місто", 11100)
        self._add_settlement("Бучач", 49.0667, 25.3833, "Тернопільська", "місто", 12100)
        self._add_settlement("Заліщики", 48.6500, 25.7333, "Тернопільська", "місто", 9400)
        self._add_settlement("Збараж", 49.6667, 25.7833, "Тернопільська", "місто", 14000)
        self._add_settlement("Зборів", 49.6667, 25.1500, "Тернопільська", "місто", 7200)
        self._add_settlement("Кременець", 50.1167, 25.7333, "Тернопільська", "місто", 20000)
        self._add_settlement("Ланівці", 49.8667, 26.0833, "Тернопільська", "місто", 8600)
        self._add_settlement("Монастириська", 49.0833, 25.1667, "Тернопільська", "місто", 5800)
        self._add_settlement("Підгайці", 49.2667, 25.1333, "Тернопільська", "місто", 2800)
        self._add_settlement("Почаїв", 50.0000, 25.5000, "Тернопільська", "місто", 8000)
        self._add_settlement("Скалат", 49.4275, 25.9783, "Тернопільська", "місто", 4000)
        self._add_settlement("Теребовля", 49.3000, 25.7000, "Тернопільська", "місто", 13500)
        self._add_settlement("Тернопіль", 49.5535, 25.5948, "Тернопільська", "обласний центр", 225000)
        self._add_settlement("Хоростків", 49.2167, 25.9333, "Тернопільська", "місто", 7000)
        self._add_settlement("Чортків", 49.0167, 25.8000, "Тернопільська", "місто", 29000)
        self._add_settlement("Шумськ", 50.1167, 26.1167, "Тернопільська", "місто", 5400)
        
        # Харківська область
        self._add_settlement("Балаклія", 49.4567, 36.8511, "Харківська", "місто", 27000)
        self._add_settlement("Барвінкове", 48.9000, 37.0167, "Харківська", "місто", 8500)
        self._add_settlement("Богодухів", 50.1667, 35.5167, "Харківська", "місто", 15500)
        self._add_settlement("Валки", 49.8353, 35.6203, "Харківська", "місто", 9000)
        self._add_settlement("Вовчанськ", 50.2833, 36.9500, "Харківська", "місто", 17800)
        self._add_settlement("Дергачі", 50.1106, 36.1211, "Харківська", "місто", 17300)
        self._add_settlement("Зміїв", 49.6833, 36.3500, "Харківська", "місто", 15100)
        self._add_settlement("Ізюм", 49.2125, 37.2617, "Харківська", "місто", 46000)
        self._add_settlement("Красноград", 49.3667, 35.4500, "Харківська", "місто", 20300)
        self._add_settlement("Куп'янськ", 49.7064, 37.6167, "Харківська", "місто", 27000)
        self._add_settlement("Лозова", 48.8833, 36.3167, "Харківська", "місто", 57000)
        self._add_settlement("Люботин", 49.9500, 35.9333, "Харківська", "місто", 21000)
        self._add_settlement("Мерефа", 49.8167, 36.0667, "Харківська", "місто", 22100)
        self._add_settlement("Первомайський", 49.3833, 36.2167, "Харківська", "місто", 29000)
        self._add_settlement("Південне", 49.8833, 36.0667, "Харківська", "місто", 7600)
        self._add_settlement("Харків", 49.9935, 36.2304, "Харківська", "обласний центр", 1441000)
        self._add_settlement("Чугуїв", 49.8356, 36.6850, "Харківська", "місто", 31400)
        
        # Херсонська область
        self._add_settlement("Білозерка", 46.6333, 32.4500, "Херсонська", "селище міського типу", 9900)
        self._add_settlement("Генічеськ", 46.1833, 34.8000, "Херсонська", "місто", 19000)
        self._add_settlement("Гола Пристань", 46.5167, 32.5167, "Херсонська", "місто", 14000)
        self._add_settlement("Каховка", 46.8000, 33.4667, "Херсонська", "місто", 35000)
        self._add_settlement("Нова Каховка", 46.7500, 33.3667, "Херсонська", "місто", 45000)
        self._add_settlement("Олешки", 46.6167, 32.7167, "Херсонська", "місто", 24500)
        self._add_settlement("Скадовськ", 46.1167, 32.9167, "Херсонська", "місто", 18000)
        self._add_settlement("Таврійськ", 46.7500, 33.4167, "Херсонська", "місто", 11000)
        self._add_settlement("Херсон", 46.6354, 32.6169, "Херсонська", "обласний центр", 283000)
        
        # Хмельницька область
        self._add_settlement("Волочиськ", 49.5333, 26.2167, "Хмельницька", "місто", 19800)
        self._add_settlement("Городок", 49.1667, 26.5667, "Хмельницька", "місто", 16800)
        self._add_settlement("Деражня", 49.2667, 27.4333, "Хмельницька", "місто", 10200)
        self._add_settlement("Дунаївці", 48.8833, 26.8500, "Хмельницька", "місто", 16200)
        self._add_settlement("Ізяслав", 50.1167, 26.8000, "Хмельницька", "місто", 17200)
        self._add_settlement("Кам'янець-Подільський", 48.6806, 26.5806, "Хмельницька", "місто", 98000)
        self._add_settlement("Красилів", 49.6500, 26.9667, "Хмельницька", "місто", 19300)
        self._add_settlement("Нетішин", 50.3333, 26.6333, "Хмельницька", "місто", 34000)
        self._add_settlement("Полонне", 50.1167, 27.5167, "Хмельницька", "місто", 21000)
        self._add_settlement("Славута", 50.3000, 26.8667, "Хмельницька", "місто", 34000)
        self._add_settlement("Старокостянтинів", 49.7572, 27.2083, "Хмельницька", "місто", 34000)
        self._add_settlement("Хмельницький", 49.4220, 26.9841, "Хмельницька", "обласний центр", 274000)
        self._add_settlement("Шепетівка", 50.1833, 27.0667, "Хмельницька", "місто", 40000)
        
        # Черкаська область
        self._add_settlement("Ватутіне", 49.0167, 31.0667, "Черкаська", "місто", 17000)
        self._add_settlement("Городище", 49.2906, 31.4514, "Черкаська", "місто", 14200)
        self._add_settlement("Жашків", 49.2500, 30.1000, "Черкаська", "місто", 14000)
        self._add_settlement("Звенигородка", 49.0833, 30.9667, "Черкаська", "місто", 17200)
        self._add_settlement("Золотоноша", 49.6833, 32.0333, "Черкаська", "місто", 28000)
        self._add_settlement("Канів", 49.7500, 31.4667, "Черкаська", "місто", 25000)
        self._add_settlement("Корсунь-Шевченківський", 49.4333, 31.2833, "Черкаська", "місто", 18300)
        self._add_settlement("Монастирище", 49.0833, 29.8000, "Черкаська", "місто", 8900)
        self._add_settlement("Сміла", 49.2167, 31.8667, "Черкаська", "місто", 68000)
        self._add_settlement("Тальне", 48.8833, 30.7000, "Черкаська", "місто", 13800)
        self._add_settlement("Умань", 48.7500, 30.2167, "Черкаська", "місто", 82000)
        self._add_settlement("Христинівка", 48.8333, 29.9667, "Черкаська", "місто", 11000)
        self._add_settlement("Черкаси", 49.4444, 32.0598, "Черкаська", "обласний центр", 269000)
        self._add_settlement("Чигирин", 49.0833, 32.6667, "Черкаська", "місто", 8800)
        self._add_settlement("Шпола", 49.0000, 31.4000, "Черкаська", "місто", 17400)
        
        # Чернівецька область
        self._add_settlement("Вашківці", 48.3833, 25.5167, "Чернівецька", "місто", 5300)
        self._add_settlement("Вижниця", 48.2500, 25.1833, "Чернівецька", "місто", 3900)
        self._add_settlement("Герца", 48.1500, 26.2500, "Чернівецька", "місто", 2100)
        self._add_settlement("Заставна", 48.5167, 25.8500, "Чернівецька", "місто", 7900)
        self._add_settlement("Кіцмань", 48.4417, 25.7611, "Чернівецька", "місто", 6300)
        self._add_settlement("Новодністровськ", 48.5833, 27.4333, "Чернівецька", "місто", 10000)
        self._add_settlement("Новоселиця", 48.2167, 26.2667, "Чернівецька", "місто", 7600)
        self._add_settlement("Сокиряни", 48.4500, 27.4167, "Чернівецька", "місто", 8600)
        self._add_settlement("Сторожинець", 48.1667, 25.7167, "Чернівецька", "місто", 14000)
        self._add_settlement("Хотин", 48.5078, 26.4922, "Чернівецька", "місто", 9000)
        self._add_settlement("Чернівці", 48.2921, 25.9358, "Чернівецька", "обласний центр", 265000)
        
        # Чернігівська область
        self._add_settlement("Батурин", 51.3333, 32.8833, "Чернігівська", "місто", 2500)
        self._add_settlement("Бахмач", 51.1833, 32.8333, "Чернігівська", "місто", 18000)
        self._add_settlement("Бобровиця", 50.7431, 31.3878, "Чернігівська", "місто", 11000)
        self._add_settlement("Борзна", 51.2333, 32.4333, "Чернігівська", "місто", 10200)
        self._add_settlement("Варва", 50.5000, 32.7167, "Чернігівська", "селище міського типу", 8000)
        self._add_settlement("Городня", 51.8903, 31.5958, "Чернігівська", "місто", 11600)
        self._add_settlement("Ічня", 50.8500, 32.4000, "Чернігівська", "місто", 11200)
        self._add_settlement("Корюківка", 51.7833, 32.2500, "Чернігівська", "місто", 13000)
        self._add_settlement("Мена", 51.5167, 32.2167, "Чернігівська", "місто", 11600)
        self._add_settlement("Ніжин", 51.0450, 31.8800, "Чернігівська", "місто", 66000)
        self._add_settlement("Новгород-Сіверський", 52.0069, 33.2611, "Чернігівська", "місто", 13000)
        self._add_settlement("Носівка", 50.9333, 31.5833, "Чернігівська", "місто", 13400)
        self._add_settlement("Остер", 50.9500, 30.8833, "Чернігівська", "місто", 6300)
        self._add_settlement("Прилуки", 50.5933, 32.3867, "Чернігівська", "місто", 55000)
        self._add_settlement("Седнів", 51.6333, 31.5667, "Чернігівська", "селище міського типу", 1300)
        self._add_settlement("Семенівка", 52.1833, 32.5833, "Чернігівська", "місто", 8300)
        self._add_settlement("Сновськ", 51.8167, 31.9500, "Чернігівська", "місто", 11100)
        self._add_settlement("Чернігів", 51.4982, 31.2893, "Чернігівська", "обласний центр", 286000)
        
        print(f"✅ Завантажено {len(self.settlements)} населених пунктів")
    
    def _add_settlement(self, name: str, lat: float, lon: float, region: str, 
                       settlement_type: str, population: int = 0):
        """Додати населений пункт до бази"""
        if name not in self.settlements:
            self.settlements[name] = []
        
        self.settlements[name].append({
            'lat': lat,
            'lon': lon,
            'region': region,
            'type': settlement_type,
            'population': population
        })
    
    def load_from_file(self, db_file: str):
        """Завантажити базу з файлу"""
        try:
            with open(db_file, 'r', encoding='utf-8') as f:
                data = json.load(f)
                self.settlements = data
            print(f"✅ Завантажено базу з файлу: {len(self.settlements)} пунктів")
        except Exception as e:
            print(f"❌ Помилка завантаження з файлу: {e}")
            self.load_default_data()
    
    def save_to_file(self, db_file: str):
        """Зберегти базу у файл"""
        try:
            with open(db_file, 'w', encoding='utf-8') as f:
                json.dump(self.settlements, f, ensure_ascii=False, indent=2)
            print(f"✅ Базу збережено у файл: {db_file}")
        except Exception as e:
            print(f"❌ Помилка збереження у файл: {e}")
    
    def find_settlements_by_prefix(self, prefix: str, limit: int = 15) -> List[dict]:
        """Знайти населені пункти за першими символами"""
        prefix_lower = prefix.lower()
        results = []
        
        for settlement_name, settlements_list in self.settlements.items():
            if settlement_name.lower().startswith(prefix_lower):
                for settlement in settlements_list:
                    results.append({
                        'name': settlement_name,
                        'full_name': f"{settlement_name} ({settlement['region']})",
                        'region': settlement['region'],
                        'lat': settlement['lat'],
                        'lon': settlement['lon'],
                        'type': settlement['type'],
                        'population': settlement.get('population', 0)
                    })
        
        # Сортуємо за населенням (більші першими), потім за назвою
        results.sort(key=lambda x: (x['population'], x['name']), reverse=True)
        
        return results[:limit]
    
    def find_settlements_by_name(self, name: str, region: str = None) -> List[dict]:
        """Знайти населені пункти за точним іменем"""
        name_lower = name.lower()
        results = []
        
        for settlement_name, settlements_list in self.settlements.items():
            if settlement_name.lower() == name_lower:
                for settlement in settlements_list:
                    if region is None or settlement['region'].lower() == region.lower():
                        results.append({
                            'name': settlement_name,
                            'full_name': f"{settlement_name} ({settlement['region']})",
                            'region': settlement['region'],
                            'lat': settlement['lat'],
                            'lon': settlement['lon'],
                            'type': settlement['type'],
                            'population': settlement.get('population', 0)
                        })
        
        return results
    
    def get_all_regions(self) -> List[str]:
        """Отримати список усіх областей"""
        regions = set()
        for settlements_list in self.settlements.values():
            for settlement in settlements_list:
                regions.add(settlement['region'])
        return sorted(list(regions))
    
    def get_regional_centers(self) -> List[dict]:
        """Отримати список обласних центрів"""
        centers = []
        for name, settlements_list in self.settlements.items():
            for settlement in settlements_list:
                if settlement['type'] in ['обласний центр', 'столиця']:
                    centers.append({
                        'name': name,
                        'region': settlement['region'],
                        'population': settlement.get('population', 0),
                        'lat': settlement['lat'],
                        'lon': settlement['lon']
                    })
                    break
        
        centers.sort(key=lambda x: x['population'], reverse=True)
        return centers
    
    def get_statistics(self) -> dict:
        """Отримати статистику бази даних"""
        total_entries = sum(len(v) for v in self.settlements.values())
        
        regions = {}
        types = {}
        
        for settlements_list in self.settlements.values():
            for settlement in settlements_list:
                region = settlement['region']
                settlement_type = settlement['type']
                
                regions[region] = regions.get(region, 0) + 1
                types[settlement_type] = types.get(settlement_type, 0) + 1
        
        # Найбільші міста
        all_settlements = []
        for name, settlements_list in self.settlements.items():
            for settlement in settlements_list:
                if settlement.get('population', 0) > 0:
                    all_settlements.append({
                        'name': name,
                        'region': settlement['region'],
                        'population': settlement['population'],
                        'type': settlement['type']
                    })
        
        all_settlements.sort(key=lambda x: x['population'], reverse=True)
        largest_cities = all_settlements[:10]
        
        # Дублікати назв
        duplicates = [name for name, lst in self.settlements.items() if len(lst) > 1]
        
        return {
            'unique_names': len(self.settlements),
            'total_entries': total_entries,
            'regions_count': len(regions),
            'regions_distribution': regions,
            'types_distribution': types,
            'largest_cities': largest_cities,
            'duplicates': duplicates,
            'duplicates_count': len(duplicates)
        }
    
    def get_coordinates(self, settlement_name: str, region: str = None) -> Tuple[Optional[float], Optional[float]]:
        """Отримати координати населеного пункту"""
        if settlement_name not in self.settlements:
            return None, None
        
        settlements = self.settlements[settlement_name]
        
        if len(settlements) == 1:
            return settlements[0]['lat'], settlements[0]['lon']
        
        if region:
            for settlement in settlements:
                if settlement['region'].lower() == region.lower():
                    return settlement['lat'], settlement['lon']
        
        return settlements[0]['lat'], settlements[0]['lon']

# Глобальний екземпляр бази даних
settlements_db = UkraineSettlementsDB()